# Copyright (c) 2025 Natalia Pluta
# SPDX-License-Identifier: Apache-2.0
#
# This file contains selected Kconfig options for the application.

# Enable logging with debug level
# CONFIG_NET_LOG=y
# CONFIG_NRF_CLOUD_LOG_LEVEL_DBG=y
# CONFIG_CLOUD_MODULE_LOG_LEVEL_DBG=y
# CONFIG_NRF_CLOUD_COAP_LOG_LEVEL_DBG=y
# CONFIG_MODEM_KEY_MGMT_LOG_LEVEL_DBG=y
# CONFIG_LOG_BUFFER_SIZE=10000

CONFIG_LOG=y
CONFIG_BLINK=y
CONFIG_HEAP_MEM_POOL_SIZE=10240

# Enable I2C and sensor subsystem for multiple sensors
CONFIG_I2C=y
CONFIG_SENSOR=y
CONFIG_BME280=y
CONFIG_CCS811=y
CONFIG_CCS811_ENV_COMPENSATION=y
CONFIG_HM330X=y
CONFIG_SEN0466=y

# Zephyr State Machine Framework
CONFIG_SMF=y
CONFIG_SMF_ANCESTOR_SUPPORT=y
CONFIG_SMF_INITIAL_TRANSITION=y

# Enable ZBUS for inter-module communication
CONFIG_ZBUS=y
CONFIG_ZBUS_MSG_SUBSCRIBER=y
CONFIG_ZBUS_CHANNEL_NAME=y
CONFIG_ZBUS_OBSERVER_NAME=y
CONFIG_ZBUS_MSG_SUBSCRIBER_NET_BUF_POOL_SIZE=64

# Enable application modules
CONFIG_SENSOR_MODULE=y
CONFIG_CONTROLLER_MODULE=y
CONFIG_NETWORK_MODULE=y

# Network module configuration
CONFIG_NETWORK_MODULE_SHELL=y
CONFIG_NETWORK_MODULE_STACK_SIZE=2048
CONFIG_NETWORK_MODULE_WATCHDOG_TIMEOUT_SECONDS=600
CONFIG_NETWORK_MODULE_MSG_PROCESSING_TIMEOUT_SECONDS=570
CONFIG_NETWORK_MODULE_SEARCH_NETWORK_ON_STARTUP=y

# LTE Link Control and Modem libraries
CONFIG_LTE_LINK_CONTROL=y
CONFIG_LTE_LC_PSM_MODULE=y
CONFIG_LTE_LC_EDRX_MODULE=y
CONFIG_LTE_LC_CONN_EVAL_MODULE=y

# Nordic Modem Library
CONFIG_NRF_MODEM_LIB=y
CONFIG_NRF_MODEM_LIB_NET_IF=y
CONFIG_NRF_MODEM_LIB_NET_IF_AUTO_DOWN=y
CONFIG_NRF_MODEM_LIB_NET_IF_DOWN_DEFAULT_LTE_DISCONNECT=y

# Networking - LTE offloaded sockets
CONFIG_NETWORKING=y
CONFIG_NET_SOCKETS=y
CONFIG_NET_SOCKETS_OFFLOAD=y
CONFIG_POSIX_API=y
CONFIG_NET_IPV4=y
CONFIG_NET_IPV6=y
CONFIG_NET_IPV6_NBR_CACHE=n
CONFIG_NET_IPV6_MLD=n

# Connection Manager
CONFIG_NET_CONNECTION_MANAGER=y
CONFIG_NET_CONNECTION_MANAGER_MONITOR_STACK_SIZE=512

# Needed due to using connectivity manager
CONFIG_NET_IF_MAX_IPV6_COUNT=2
CONFIG_NET_IF_MAX_IPV4_COUNT=2

# Network statistics (useful for debugging)
CONFIG_NET_STATISTICS=y
CONFIG_NET_STATISTICS_USER_API=y
CONFIG_NET_CONTEXT_SYNC_RECV=y

# nRF Cloud
CONFIG_NRF_CLOUD=y
CONFIG_NRF_CLOUD_COAP=y
CONFIG_NRF_CLOUD_COAP_DISCONNECT_ON_FAILED_REQUEST=y
CONFIG_NRF_CLOUD_PRINT_DETAILS=y
CONFIG_NRF_CLOUD_SEND_DEVICE_STATUS=y
CONFIG_NRF_CLOUD_SEND_DEVICE_STATUS_NETWORK=y
CONFIG_NRF_CLOUD_SEND_DEVICE_STATUS_SIM=y
CONFIG_NRF_CLOUD_SEND_SERVICE_INFO_FOTA=y

# Modem
CONFIG_MODEM_JWT=y
CONFIG_MODEM_INFO=y
CONFIG_MODEM_INFO_ADD_DEVICE=y
CONFIG_MODEM_KEY_MGMT=y


# Credentials
CONFIG_NRF_CLOUD_CLIENT_ID_SRC_IMEI=y       # Use IMEI for Client ID as INTERNAL_UUID requires nRF91x1
CONFIG_NRF_CLOUD_CHECK_CREDENTIALS=y
CONFIG_NRF_CLOUD_CREDENTIALS_MGMT_MODEM=y

# COAP client
CONFIG_COAP=y
CONFIG_COAP_CLIENT=y
CONFIG_COAP_MAX_RETRANSMIT=5
CONFIG_COAP_INIT_ACK_TIMEOUT_MS=5000
# Set CoAP therad to same priority as other modules
CONFIG_COAP_CLIENT_THREAD_PRIORITY=14
CONFIG_COAP_CLIENT_BLOCK_SIZE=1024
CONFIG_COAP_CLIENT_MESSAGE_SIZE=1024
CONFIG_COAP_CLIENT_STACK_SIZE=1280
CONFIG_COAP_EXTENDED_OPTIONS_LEN_VALUE=192
CONFIG_NRF_CLOUD_COAP_DOWNLOADS=y

# Downloader support (required by NRF_CLOUD_COAP_DOWNLOADS)
CONFIG_DOWNLOADER=y

# needed for processing floats
CONFIG_PICOLIBC=y
CONFIG_FPU=y

# Date and time configuration
CONFIG_DATE_TIME=y
CONFIG_DATE_TIME_MODEM=y
CONFIG_DATE_TIME_AUTO_UPDATE=y

# AT Monitor configuration to prevent heap exhaustion
CONFIG_AT_MONITOR=y
CONFIG_AT_MONITOR_HEAP_SIZE=2048

# Shell configuration
CONFIG_UART_INTERRUPT_DRIVEN=y
CONFIG_SHELL=y
CONFIG_SHELL_WILDCARD=n
CONFIG_SHELL_STACK_SIZE=2048
CONFIG_SHELL_CMD_BUFF_SIZE=2048
CONFIG_SHELL_BACKEND_SERIAL_RX_RING_BUFFER_SIZE=2048
CONFIG_AT_SHELL=y

# Task Watchdog
CONFIG_TASK_WDT=y
CONFIG_TASK_WDT_CHANNELS=8
CONFIG_TASK_WDT_MIN_TIMEOUT=10000
